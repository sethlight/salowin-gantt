# SALOWIN ガントチャート

チームでプロジェクトのスケジュールを管理できる **Webベースのガントチャートツール** です。
ブラウザだけで使えるので、インストールは不要です。

## どんなことができるの？

### プロジェクト管理
- **プロジェクトの作成・編集・削除** - 複数のプロジェクトを一覧で管理
- **メンバー招待** - メールアドレスでチームメンバーを招待（権限：オーナー / 編集者 / 閲覧者）

### ガントチャート
- **タスクの追加・編集・削除** - タスク名、担当者、ステータス、進捗率を設定
- **ドラッグ＆ドロップでスケジュール変更** - バーを掴んで日程を移動
- **タスクの階層化** - インデント（字下げ）で親タスク・子タスクを表現
- **開始日・締切日の設定** - 日付入力またはバーの端をドラッグして期間を調整
- **締切アラート** - 締切が近い・過ぎたタスクを色付きで警告表示
- **今日のラインジャンプ** - ワンクリックで本日の日付へスクロール
- **元に戻す / やり直し** - 操作の取り消し・やり直しが可能

### ノート＆コメント
- **リッチテキストノート** - 各タスクに見出し・太字・リスト付きのノートを記録（左右2分割のモーダル）
- **コメント機能** - タスクごとにコメントを投稿し、チーム内でやり取り
- **コメントの解決・削除** - 完了したコメントにチェックを付けて整理

### Chatwork通知
- **コメント投稿時に自動通知** - Chatworkの指定ルームへ、タスク名・送信者・URLを含む通知メッセージを送信
- **プロジェクトごとに設定** - プロジェクトカードの設定アイコンからChatwork Room IDとAPIトークンを登録

### リアルタイム同期
- **複数人同時編集** - チームメンバーが同時にガントチャートを操作可能
- **オンライン状況の表示** - 誰がいま閲覧しているかリアルタイムで確認

### 認証
- **メール＆パスワード認証** - アカウント登録・ログイン
- **パスワードリセット** - メールでリセットリンクを送信し、新しいパスワードを設定

---

## セキュリティについて

このツールでは、**データの安全性**を複数のレベルで確保しています。

### 誰がどのデータを見られるか（アクセス制御）

データベースの各テーブルに **Row Level Security（RLS）** というルールが設定されており、ログインしたユーザーが自分の権限に応じたデータしか操作できないようになっています。

| 操作 | オーナー | 編集者 | 閲覧者 | 未ログイン |
|------|:--------:|:------:|:------:|:----------:|
| プロジェクトの閲覧 | OK | OK | OK | NG |
| タスクの閲覧 | OK | OK | OK | NG |
| タスクの追加・編集・削除 | OK | OK | NG | NG |
| ノート・コメントの閲覧 | OK | OK | OK | NG |
| ノート・コメントの追加・編集 | OK | OK | NG | NG |
| メンバーの招待・削除 | OK | NG | NG | NG |
| プロジェクト設定の変更 | OK | NG | NG | NG |
| プロジェクトの削除 | OK | NG | NG | NG |

> これらのルールは**サーバー側（データベース側）で強制**されるため、ブラウザの開発者ツールなどで操作しても回避できません。

### 認証の安全性

- **パスワードのハッシュ化** - パスワードは暗号化されてSupabaseに保存され、生のパスワードはどこにも保存されません
- **JWT（トークン）認証** - ログイン後はブラウザに安全なトークンが発行され、以降のアクセスに使用されます
- **セッション自動管理** - トークンの期限切れ時は自動更新され、安全な状態が維持されます

### Chatwork APIトークンの保護

- Chatwork APIトークンはデータベースに保存され、**RLSにより閲覧できるのはプロジェクトメンバーのみ**、変更できるのはオーナーのみです
- Chatwork APIの呼び出しは **サーバー側の Edge Function（Supabase Edge Functions）** から行われ、トークンがブラウザに露出しません
- Edge Function内で**ユーザー認証とメンバーシップを検証**してから通知を送信します

### フロントエンドの公開キー

ソースコードに含まれている `SUPABASE_ANON_KEY` は**公開用の匿名キー**です。このキーだけではデータにアクセスできず、必ずRLSルールを通過する必要があるため、公開しても安全です（Supabase公式の設計方針）。

---

## 技術構成の全体像

### アーキテクチャ図

```
┌─────────────────────────────────────────────────────┐
│  ブラウザ（フロントエンド）                              │
│  HTML / CSS / JavaScript                            │
│  ・ガントチャートUI  ・ノートエディタ（Quill.js）          │
│  ・ダッシュボード    ・リアルタイム同期                    │
└──────────┬──────────────────────┬────────────────────┘
           │ HTTPS               │ WebSocket
           ▼                     ▼
┌──────────────────────────────────────────────────────┐
│  Supabase（バックエンド - フルマネージド）                │
│                                                      │
│  ┌──────────┐ ┌──────────┐ ┌────────────────────┐   │
│  │PostgreSQL│ │   Auth   │ │     Realtime       │   │
│  │(データDB) │ │ (認証)   │ │ (リアルタイム同期)  │   │
│  │+ RLS     │ │          │ │                    │   │
│  └──────────┘ └──────────┘ └────────────────────┘   │
│                                                      │
│  ┌────────────────────────────────────────────┐      │
│  │  Edge Functions (サーバーサイド処理)          │      │
│  │  ・chatwork-notify: Chatwork API通知送信     │      │
│  └──────────────────────┬─────────────────────┘      │
└─────────────────────────┼────────────────────────────┘
                          │ HTTPS
                          ▼
                ┌──────────────────┐
                │   Chatwork API   │
                └──────────────────┘

┌──────────────────────────────────────────────────────┐
│  Vercel（ホスティング）                                │
│  HTML / CSS / JS の静的ファイル配信                      │
│  CDN経由で高速配信、HTTPS自動対応                        │
└──────────────────────────────────────────────────────┘
```

### なぜこの構成なのか？

| 選択 | 理由 |
|------|------|
| **Supabase** | PostgreSQL + 認証 + リアルタイム + Edge Functionsがワンセットで使え、サーバー管理が不要。RLSでセキュリティも担保 |
| **Vercel** | 静的ファイルをCDN経由で高速配信。GitHubと連携したデプロイも可能。HTTPS自動対応 |
| **フレームワーク不使用** | React/Vue等を使わず素のHTMLとJavaScriptで構築。ビルドツール不要で、デプロイがシンプル |
| **Edge Functions** | Chatwork APIトークンをブラウザに露出させず、サーバー側で安全にAPI呼び出しを行うために使用 |
| **Quill.js** | 軽量かつ高機能なリッチテキストエディタ。見出し・太字・リスト等の書式をGUIで操作可能 |

### 主な技術要素

| 区分 | 技術 | 役割 |
|------|------|------|
| フロントエンド | HTML / CSS / JavaScript | ユーザーが操作する画面（UIの表示・操作） |
| エディタ | Quill.js | タスクのノートを書式付きで編集するエディタ |
| データベース | PostgreSQL（Supabase） | プロジェクト・タスク・コメント等すべてのデータを保存 |
| 認証 | Supabase Auth | ログイン・サインアップ・パスワードリセットを管理 |
| リアルタイム | Supabase Realtime（WebSocket） | 複数人が同時に操作した変更を即座に全員に反映 |
| サーバー処理 | Supabase Edge Functions（Deno） | Chatwork通知など、ブラウザでは行えない処理をサーバー側で実行 |
| セキュリティ | Row Level Security（RLS） | データベースレベルでアクセス権限を強制（権限のないデータは取得すらできない） |
| ホスティング | Vercel | Webサイトのファイルをインターネットに公開・配信 |

---

## フォルダ構成

```
gantt-app/
├── index.html              # ダッシュボード（ログイン・プロジェクト一覧）
├── gantt.html              # ガントチャート画面
├── auth-callback.html      # 認証コールバック（パスワードリセット処理）
├── vercel.json             # Vercelデプロイ設定
├── css/
│   ├── common.css          # 共通スタイル
│   ├── dashboard.css       # ダッシュボード用スタイル
│   └── gantt.css           # ガントチャート用スタイル
├── js/
│   ├── config.js           # Supabase接続設定
│   ├── auth.js             # 認証処理（ログイン・サインアップ・リセット）
│   ├── supabase-client.js  # Supabaseクライアント初期化
│   ├── db/
│   │   ├── projects.js     # プロジェクトCRUD
│   │   ├── tasks.js        # タスクCRUD
│   │   ├── notes.js        # ノートCRUD
│   │   ├── comments.js     # コメントCRUD
│   │   ├── members.js      # メンバー管理
│   │   └── settings.js     # プロジェクト設定（Chatwork連携）
│   ├── realtime/
│   │   ├── subscriptions.js    # リアルタイム購読
│   │   ├── conflict-resolver.js # 競合解決
│   │   └── presence.js         # オンラインプレゼンス
│   └── migration/
│       └── import-gas-data.js  # GASからの移行ツール
└── supabase/
    ├── migrations/
    │   └── 00001_initial_schema.sql  # DBスキーマ（テーブル・RLS定義）
    └── functions/
        └── chatwork-notify/
            └── index.ts              # Chatwork通知Edge Function
```

## データベーステーブル

| テーブル | 説明 |
|---------|------|
| `profiles` | ユーザー情報（auth.usersのミラー） |
| `projects` | プロジェクト |
| `project_members` | プロジェクトメンバーと権限（owner / editor / viewer） |
| `tasks` | ガントチャートのタスク（階層・日程・進捗） |
| `notes` | タスクに紐づくリッチテキストノート |
| `comments` | タスクに紐づくコメント |
| `project_settings` | プロジェクト設定（Chatwork連携情報） |

---

## 用語集（このプロダクトを理解するために）

このプロダクトで使われている技術用語を、身近なたとえで説明します。

### 基本の仕組み

| 用語 | ひとことで | くわしく |
|------|----------|---------|
| **フロントエンド** | 「お店の店頭」 | ユーザーが実際に目で見て操作する画面部分のこと。ブラウザに表示されるボタン、入力欄、ガントチャートの棒グラフなど、すべてフロントエンドです |
| **バックエンド** | 「お店の裏方・倉庫」 | ユーザーからは見えない、サーバー側の処理のこと。データの保存、ログインの確認、Chatworkへの通知送信などを担当します |
| **サーバー** | 「24時間営業の倉庫係」 | インターネット上で常に動いているコンピュータ。ブラウザからの要求を受け取り、データを返したり保存したりします |
| **データベース（DB）** | 「整理された大きなExcelファイル」 | プロジェクト、タスク、コメントなどすべてのデータを表（テーブル）形式で保存する場所。Excelと違い、何千人が同時にアクセスしても壊れません |
| **テーブル** | 「Excelのシート1枚」 | データベースの中の1つの表のこと。例えば「タスク一覧」「コメント一覧」など、種類ごとに分かれています |

### 通信の仕組み

| 用語 | ひとことで | くわしく |
|------|----------|---------|
| **HTTPS** | 「鍵付きの郵便」 | ブラウザとサーバー間の通信を暗号化する仕組み。URLが `https://` で始まるサイトは、通信内容が途中で盗み見られません。このツールはすべての通信がHTTPSです |
| **WebSocket** | 「常時つながった電話回線」 | 通常の通信（HTTPS）は「手紙のやり取り」のように1回1回送受信しますが、WebSocketは電話のように常につながった状態。これにより、誰かがタスクを変更した瞬間に全員の画面に反映されます |
| **API** | 「注文カウンター」 | ソフトウェア同士がデータをやり取りする窓口。例えば「Chatwork API」とは、Chatworkにメッセージを送るための窓口のこと。決められた形式で注文（リクエスト）を出すと、結果が返ってきます |
| **APIトークン** | 「会員証・身分証」 | APIを使うときに「自分が誰か」を証明するための文字列。Chatwork APIトークンを使って、このツールがChatworkにメッセージを送信する権限を得ています |

### セキュリティ・認証

| 用語 | ひとことで | くわしく |
|------|----------|---------|
| **認証（Auth）** | 「ログインの仕組み」 | 「あなたは本当にこのユーザーですか？」を確認する仕組み。メールアドレスとパスワードで本人確認します |
| **JWT（ジェイダブリューティー）** | 「入場パスバンド」 | ログイン後にサーバーから発行される「通行証」のようなもの。以降の操作ではこの通行証を提示することで、毎回パスワードを入力しなくても本人と確認できます |
| **ハッシュ化** | 「元に戻せない暗号化」 | パスワードを意味不明な文字列に変換して保存する方法。万が一データが漏洩しても、元のパスワードは復元できません |
| **RLS（Row Level Security）** | 「行ごとの閲覧制限」 | データベースの各行（データ1件ごと）に「誰が見られるか・編集できるか」のルールを設定する仕組み。プログラムのバグがあっても、データベースが最後の砦としてデータを守ります |
| **セッション** | 「ログイン中の状態」 | ログインしてからログアウトするまでの一連の接続状態。セッションが有効な間は、ページを移動してもログイン状態が維持されます |

### このツールで使っているサービス

| 用語 | ひとことで | くわしく |
|------|----------|---------|
| **Supabase（スーパーベース）** | 「バックエンド丸ごとセット」 | データベース、ログイン機能、リアルタイム同期、サーバー処理をまとめて提供してくれるクラウドサービス。自分でサーバーを用意する必要がありません |
| **PostgreSQL（ポストグレスキューエル）** | 「高性能なデータベース」 | 世界で最も人気のあるデータベースの1つ。Supabaseの中で動いており、プロジェクト・タスク・コメントなどのデータを保存しています |
| **Edge Functions（エッジファンクション）** | 「サーバー上で動くミニプログラム」 | Supabase上で動く小さなプログラム。このツールではChatwork通知の送信に使っています。APIトークンなどの秘密情報をブラウザに渡さず、サーバー側だけで処理できます |
| **Vercel（ヴァーセル）** | 「Webサイトの公開サービス」 | HTMLやCSS等のファイルをインターネット上に公開してくれるサービス。世界中のサーバー（CDN）にファイルを配置するため、どこからアクセスしても高速に表示されます |
| **CDN（シーディーエヌ）** | 「世界中にある配達拠点」 | Content Delivery Networkの略。東京、大阪、ニューヨークなど世界各地にサーバーがあり、ユーザーに一番近い場所からデータを届けるため、表示が速くなります |

### プログラミング言語・ツール

| 用語 | ひとことで | くわしく |
|------|----------|---------|
| **HTML** | 「ページの骨組み」 | Webページの構造を定義する言語。「ここにボタンを置く」「ここに入力欄を置く」といったページの骨格を作ります |
| **CSS** | 「ページの見た目」 | HTMLで作った骨組みに色、大きさ、配置などのデザインを適用する言語。ガントチャートのピンク色の背景や、ボタンの丸みなどはCSSで定義しています |
| **JavaScript** | 「ページの動き」 | ボタンを押したときの動作、データの保存、リアルタイム更新などWebページに「動き」をつける言語。このツールの主要なプログラム部分はJavaScriptで書かれています |
| **Quill.js（クイルジェイエス）** | 「書式付きエディタの部品」 | ノート機能で使っているリッチテキストエディタ。太字・見出し・箇条書きなどをWordのように操作できます |
| **Deno（ディーノ）** | 「サーバー側のJavaScript実行環境」 | Edge FunctionsがJavaScript/TypeScriptを実行するための基盤。ブラウザの外（サーバー上）でプログラムを動かします |
| **TypeScript** | 「より安全なJavaScript」 | JavaScriptに型チェック（データの種類の確認）を追加した言語。Edge Functionのコード（`index.ts`）で使用しています |

### その他の用語

| 用語 | ひとことで | くわしく |
|------|----------|---------|
| **デプロイ** | 「本番公開すること」 | 開発したプログラムをインターネット上のサーバーに配置して、誰でもアクセスできる状態にすること |
| **リポジトリ** | 「プログラムの保管庫」 | プログラムのソースコードとその変更履歴をまとめて管理する場所。GitHub上にこのツールのリポジトリがあります |
| **Git / GitHub** | 「変更履歴の記録係 / その保管サービス」 | Gitはファイルの変更履歴を記録する仕組み。GitHubはその履歴をインターネット上に保存・共有するサービスです |
| **CRUD（クラッド）** | 「データ操作の4つの基本」 | Create（作成）、Read（読み取り）、Update（更新）、Delete（削除）の頭文字。データの基本操作をまとめた呼び方です |
| **リアルタイム同期** | 「全員の画面が同時に更新」 | Aさんがタスクを変更すると、Bさん・Cさんの画面にもページを更新せずに即座に反映される仕組み。WebSocketを使って実現しています |
| **フルマネージド** | 「お任せ運用」 | サーバーの管理・メンテナンス・セキュリティ更新などを、サービス提供者（Supabase、Vercel）がすべて行ってくれること。自分でサーバーを監視する必要がありません |

---

## セットアップ手順

1. **Supabase** でプロジェクトを作成し、`supabase/migrations/00001_initial_schema.sql` を実行
2. `js/config.js` にSupabaseのURL・anonキーを設定
3. Supabase Dashboard > Authentication > URL Configuration でサイトURLを設定
4. **Vercel** にデプロイ（`vercel --prod`）
5. Chatwork通知を使う場合は `supabase functions deploy chatwork-notify --no-verify-jwt` でEdge Functionをデプロイ

---

## 本番URL

https://gantt-app-nu.vercel.app
